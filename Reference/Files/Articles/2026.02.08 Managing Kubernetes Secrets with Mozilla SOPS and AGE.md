#sops #secrets #medium #encryption #k8s 

https://medium.com/@cbaah123/managing-kubernetes-secrets-with-mozilla-sops-and-age-780c84e6ec5e

Managing sensitive data in Kubernetes can be tricky, in the form of passwords, credentials, tokens, keys and other sensitive data. However, secrets in Kubernetes are base64 encoded by default, making it easy for the actual value to be revealed. These secrets are sometimes hardcoded in YAML files and in extreme committed accidentally to Git.

In this guide, we will securely encrypt Kubernetes secrets with [Mozilla SOPS (Secrets Operations)](https://github.com/getsops/sops) and [ag](https://github.com/FiloSottile/age)e, enabling you to store encrypted secrets in Git.

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:1050/1*PRGAGnkudUYAEjGQLc6s6w.png)

Kubernetes Secret | Sops and age

### What are Kubernetes Secrets?

Kubernetes Secrets are objects that store sensitive data from container images and application code. It pods consume these secrets at runtime as environment variables or mounted volumes that enable secure and dynamic configuration management.

### Why does it matter

In modern applications, transactions and activities like database connections, making API calls to external services and performing user authentication, among others rely on credentials configured in our application. These require them to be managed and configured properly. If not, secrets that are exposed will lead to security incidents that cost more than just money.

### Best Practices for Kubernetes Secrets

- **Never Hardcode Secrets:** Don’t use your credentials in your application code directly, reference them via an environment variable.
- **Use RBAC to limit access:** Only allow users or service accounts to have access to only the resources needed to perform their operations.
- **Enable Encryption at Rest:** By default, Kubernetes Secrets are stored in etcd. Encrypting them at rest protects sensitive data even if someone gains access to the datastore.
- **Rotate secrets regularly:** This minimizes security impact and ensures compliance with security standards.

### **Let’s get into action**

We will create a Kubernetes Secret file and manage it properly so it can be safely pushed to Git. This allows teams to collaborate while keeping the file encrypted and maintaining its integrity.

**Prerequisites**

- [KinD](https://kind.sigs.k8s.io/) — A tool for running local Kubernetes clusters using Docker containers
- [Docker](https://www.docker.com/) — A platform for running containerization technology

You can access [the source via GitHub](https://github.com/CyrilBaah/encrypt_sops_age)

**Step1: Setup Kubernetes Cluster**

make create-cluster 

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:1050/1*I72qJzaNFB7eYu5WxR_ZOA.png)

k8s cluster

**Step2: Install** [**Sops**](https://github.com/getsops/sops) **and** [**age**](https://github.com/FiloSottile/age)

brew install age  
brew install sops

**Step3: Generate an age Key Pair  
**A file is created named `age-key.txt` _keep it private and (_**_DO NOT COMMIT_**_)_

age-keygen -o age-key.txt

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:1050/1*VV2E01Ot5NKrIOJ16CNmOw.png)

age: key pair generation

**Step4: Encryption configuration**

mkdir ~/.sops  
mv ./age-key.txt ~/.sops  
nano ~/.zshrc 

Add this to the end of the file

export SOPS_AGE_KEY_FILE=$HOME/.sops/age-key.txt

source ~/.zshrc   
# or source ~/.bashrc

**Step5: Create a Kubernetes Secret Manifest**

apiVersion: v1  
kind: Secret  
metadata:  
  name: db-secret  
type: Opaque  
stringData:  
  username: admin  
  password: adminpassword

kubectl apply -f secret.yaml

**Step6: Encrypt the secret file with Sops  
**After encryption, the encrypted file is named`secret.enc.yaml` is safe to push to Git

sops --encrypt \  
  --age age16vjgcpuwh3x65mzx5wu9pnxwz9qkd5zhwyvxnt7570g8myhaygsqx4kq3c \  
  secret.yaml > secret.enc.yaml

apiVersion: ENC[AES256_GCM,data:/N0=,iv:ekBjXhCGDwbVbmHtzW1SNeoZc68VZLBSJ+aPPKeGBrI=,tag:vrzusx3UpbksFh/20iDbtQ==,type:str]  
kind: ENC[AES256_GCM,data:+OX5ix5z,iv:E0bXe0j9TQ1qHzgcq8F323RYwbH2tuN1K32kuZ98zcI=,tag:juNkqBgnsccyA+B7KBTeQA==,type:str]  
metadata:  
    name: ENC[AES256_GCM,data:Hnz3w5r9LXQs,iv:35ECpeRIMI/dSzf4AJUCTtWaU0C7iVHfgfj50vls0dE=,tag:EaPXTKyNBc7/OHeUt0l/8Q==,type:str]  
type: ENC[AES256_GCM,data:MX/kxy7X,iv:nfC54YF5fDUlKKsUf5I32qzC+gRlr2YvWknAh/RC7eA=,tag:m9XgeXK8TzJHlBF2GQPpMw==,type:str]  
stringData:  
    username: ENC[AES256_GCM,data:OQi3e4g=,iv:N9sKFSun6lB5QupJOcmQmzplnRBhHg46BEpEfLMy9Uk=,tag:SJwWCCtZWvt3/T2x4mfh2w==,type:str]  
    password: ENC[AES256_GCM,data:giUkDAkETbYRGJS4ow==,iv:EDCnToa1pXEwIsmC++IKS6dCYRehLyL275UOFBTeltg=,tag:iL5xBtYwEVXDqZeNaVEnqg==,type:str]  
sops:  
    age:  
        - recipient: age16vjgcpuwh3x65mzx5wu9pnxwz9qkd5zhwyvxnt7570g8myhaygsqx4kq3c  
          enc: |  
            -----BEGIN AGE ENCRYPTED FILE-----  
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBmblc4YzFjTm5GUmFQaGFM  
            NDJSUVFHV3VQSDNOWkZPSGExMjRVNmpPcEhBClA0N1VpMVQ4czR5dUFaRHFCZFh6  
            dXBXNzVvd0pBVEVwcENNZ0ovNnlYSjAKLS0tIHNPeldvY2k5bCs0bGxxOFpjUFdF  
            OWZzUWViQkpNTGJqcEgrRC9LTVBWVU0KohasafXf1kXHd3JV1cz2zNXR2gIr3Yqo  
            GU1qxKil+9BAENyr5lANaA9wYgxB7Eq7XWHmEe3JgkKrfk0oA0GJZA==  
            -----END AGE ENCRYPTED FILE-----  
    lastmodified: "2026-02-08T15:03:00Z"  
    mac: ENC[AES256_GCM,data:z5EKz6J1YM5wObXVceVzN/cfoC2yr7L9+Yh5iLs3kPH/tHY0cBeoSw5LexGxkseIQS7z2F1Vpsgmg3ijEieuBNZtUKWGujEj/DsaEdIxVohfA3oVWohGJgKXFo2sfLR+ApIHWAjW0q6vxaheWYEeRIYXlNAjVMZBbm0jSe6ibNg=,iv:KAAld7ZyvQulleWImj5vZgwdiFma9y8mpiJyb52jk68=,tag:0TQ5D4mcn6e8tx98OXFXmw==,type:str]  
    unencrypted_suffix: _unencrypted  
    version: 3.11.0

**Step7: Decrypt when needed**

sops --decrypt secret.enc.yaml

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:1050/1*wfu2L0ZV6fAjy7I7f3COUw.png)

secret.enc.yaml | decrypted

### Conclusion

Safeguarding secrets is vital because a lot depends on them. Ensuring that passwords, tokens and sensitive files are securely encrypted reduces security risks. With this, teams collaborating through Git can push encrypted files that would prevent sensitive data from being exposed.