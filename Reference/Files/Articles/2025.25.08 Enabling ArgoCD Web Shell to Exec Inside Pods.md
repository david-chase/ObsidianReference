#argocd #deployment #medium #exec

ArgoCD includes a web shell that allows users to exec into pods directly from the ArgoCD interface. This feature is useful for quick debugging, but it is disabled by default. To enable it on Amazon EKS you must configure ArgoCD settings, Ingress WebSocket support, and Kubernetes RBAC so users have permission to open an exec session.

### What Can We Expect From this Post?

This guide explains how to enable the exec feature like the following:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:519/1*TZja9_U3PkLC-vAn09MqRg.png)

## Enable Exec Support in the ArgoCD Configuration

ArgoCD must explicitly allow exec. This is set in the argocd-cm ConfigMap.

apiVersion: v1  
kind: ConfigMap  
metadata:  
  name: argocd-cm  
  namespace: argocd  
data:  
  exec.enabled: "true" #<- This line

Apply the change. The argocd-server deployment automatically reloads the configuration.

## Configure WebSockets in the Ingress Controller

The web shell uses a WebSocket connection. Your Ingress must forward the correct Upgrade and Connection headers. The NGINX Ingress Controller needs specific annotations.

Example for the argocd-server service:

apiVersion: networking.k8s.io/v1  
kind: Ingress  
metadata:  
  name: argocd-server  
  namespace: argocd  
  annotations:  
    nginx.ingress.kubernetes.io/websocket-services: argocd-server #<- This line  
spec:  
  # your existing configuration

This ensures the Ingress does not break the WebSocket connection used by the terminal.

## Required RBAC on the ArgoCD Server Components

ArgoCD itself must have permission to create exec sessions on pods. This requires updates in the Role and ClusterRole that the argocd-server uses.

## Role update for the argocd-server service account

apiVersion: rbac.authorization.k8s.io/v1  
kind: Role  
metadata:  
  name: argocd-server  
  namespace: argocd  
rules:  
  - apiGroups:  
      - ""  
    resources:  
      - pods/exec  
    verbs:  
      - create

## ClusterRole update for global access

apiVersion: rbac.authorization.k8s.io/v1  
kind: ClusterRole  
metadata:  
  name: argocd-server  
rules:  
  - apiGroups:  
      - ""  
    resources:  
      - pods/exec  
    verbs:  
      - create  
  - apiGroups:  
      - ""  
    resources:  
      - pods  
    verbs:  
      - get

This allows ArgoCD to fetch pod information and open exec sessions.

## RBAC for End Users

You also need to give users permission to run exec through ArgoCD. Instead of granting everyone admin rights, create a custom role with the minimum required permissions.

Example of a dedicated role called dev-operators:

p, role:dev-operators, exec, create, */*, allow

Example of assigning this role to a group:

g, my-team, role:dev-operators

These entries go inside argocd-rbac-cm:

kubectl get configmap -n argocd argocd-rbac-cm

This allows users in the my-team group to exec into any pod managed by ArgoCD without giving them full admin access.

You can find more details about Argocd RBAC here:

[

## RBAC Configuration - Argo CD - Declarative GitOps CD for Kubernetes

### The RBAC feature enables restrictions of access to Argo CD resources. Argo CD does not have its own user management…

argo-cd.readthedocs.io







](https://argo-cd.readthedocs.io/en/stable/operator-manual/rbac/?source=post_page-----0082d808f6c6---------------------------------------)

## Validate the Setup

Once everything is in place test the terminal.

Open the ArgoCD UI;  
Select an application:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:831/1*-gCvyFZv10AuLWCOJEBysg.png)

Select a pod;  
Open the terminal:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:519/1*TZja9_U3PkLC-vAn09MqRg.png)

If the configuration is correct the shell opens and commands run normally:

Press enter or click to view image in full size

![](https://miro.medium.com/v2/resize:fit:831/1*niOSCFDVg0PMY0lkyu_Knw.png)

## Troubleshooting

If it fails verify Ingress logs for WebSocket issues and ArgoCD logs for RBAC denials.

Also, press F12 or right click and select “inspect”, go to the networking tab and check if there’s any errors like this:

![](https://miro.medium.com/v2/resize:fit:507/1*HvHWCAYXSUHVKkD6Dy70qA.png)

This is because websocket is being blocked somewhere. If you added the ingress annotation, you will be fine unless there’s a specific network setting on your network that is blocking it.

## Notes for Amazon EKS

Amazon EKS does not require any special settings for exec. Network Load balancers already support WebSockets and the cluster handles exec normally. The main work is in ArgoCD and the Ingress configuration.

## Final Thoughts

ArgoCD web exec allows you to give more flexibility to your team without giving them too much permission, such as a kubeconfig file, which in some cases can be misconfigured with broad permissions. This way you keep teams isolated in their own Argocd projects, at the same time they have full access to their workloads!